rbac:
  create: true

grafana:
  enabled: true
  adminUser: admin
  adminPassword: strongpassword123  # change this
  defaultDashboardsEnabled: true
  sidecar:
    dashboards:
      enabled: true
    datasources:
      enabled: true
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - grafana.observabilitystack.run.place
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.observabilitystack.run.place

prometheus:
  prometheusSpec:
    replicas: 1
    retention: 15d
    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: 2
        memory: 4Gi
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 20Gi

    # Native HTTPS for Prometheus web UI + mTLS optional
    web:
      tlsConfig:
        keySecret:
          name: prometheus-tls
          key: tls.key
        cert:
          name: prometheus-tls
          key: tls.crt
        # To enforce client certs to the web UI, uncomment the next two lines:
        # clientAuthType: RequireAndVerifyClientCert
        # clientCA:
        #   name: prometheus-ca
        #   key: ca.crt

    # External VM scrape over HTTPS
    additionalScrapeConfigs:
      - job_name: 'external-vms'
        scheme: https
        tls_config:
          ca_file: /etc/prometheus/secrets/ca.crt
          insecure_skip_verify: false
          # If you have a client cert/key for mTLS to exporters, uncomment:
          cert_file: /etc/prometheus/secrets/client.crt
          key_file: /etc/prometheus/secrets/client.key
        static_configs:
          - targets:
              - 'vm1.example.com:9100'
              - 'vm2.example.com:9100'

  # Ingress to expose Prometheus via NGINX (TLS at ingress + native HTTPS behind)
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - prometheus.observabilitystack.run.place
    tls:
      - secretName: prometheus-tls
        hosts:
          - prometheus.observabilitystack.run.place

alertmanager:
  enabled: true
  alertmanagerSpec:
    replicas: 1
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1
        memory: 1Gi

    # Native HTTPS for Alertmanager web UI + mTLS optional
    web:
      tlsConfig:
        keySecret:
          name: alertmanager-tls
          key: tls.key
        cert:
          name: alertmanager-tls
          key: tls.crt
        # To enforce client certs to the web UI, uncomment:
        # clientAuthType: RequireAndVerifyClientCert
        # clientCA:
        #   name: alertmanager-ca
        #   key: ca.crt

  # Ingress to expose Alertmanager via NGINX
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - alertmanager.observabilitystack.run.place
    tls:
      - secretName: alertmanager-tls
        hosts:
          - alertmanager.observabilitystack.run.place

defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: true
    general: true
    k8s: true
    kubeApiserver: true
    kubePrometheusGeneral: true
    kubePrometheusNodeAlerting: true
    node: true
    prometheus: true
